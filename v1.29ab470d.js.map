{"mappings":"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","sources":["src/animation.v1.ts","src/index.v1.ts"],"sourcesContent":["import { BehaviorSubject, filter, forkJoin, map, switchMap, tap } from 'rxjs';\n\nimport { Line, Point } from './types';\nimport { Canvas } from './canvas';\nimport {\n  applyOffset,\n  calcLineAngle,\n  calcLineLength,\n  calcPointInPolarSystem,\n  createLine,\n  generateSides,\n  generateTornLine,\n} from './math';\nimport { AnimationSettings } from './settings';\n\nexport default class Animation {\n  private readonly _tick$ = new BehaviorSubject(0);\n\n  private readonly sides = generateSides(this.width, this.height);\n\n  private currentLine!: Line;\n\n  private tornLine!: Point[];\n\n  public get tick$() {\n    return this._tick$.asObservable();\n  }\n\n  constructor(\n    private readonly canvas: Canvas,\n    private readonly prevCanvasImg: HTMLImageElement,\n    private readonly width: number,\n    private readonly height: number,\n    private readonly offset: Point,\n    private readonly settings: AnimationSettings,\n  ) {\n    this.setup();\n  }\n\n  public dispatch() {\n    this._tick$.next(this._tick$.value + 1);\n  }\n\n  private setup() {\n    this.canvas.fill(this.settings.data.backgroundColor);\n\n    // Generate torn line every ${this.speed} ticks.\n    this.tick$\n      .pipe(\n        filter((time) => time % this.settings.data.lineLifeTicks === 0),\n        switchMap(() => {\n          return this.canvas.toDataUrl();\n        }),\n        tap((canvasImg) => {\n          this.prevCanvasImg.src = canvasImg;\n        }),\n      )\n      .subscribe(() => {\n        this.currentLine = createLine(this.sides, this.offset);\n        const lineLength = calcLineLength(this.currentLine.start, this.currentLine.end);\n\n        this.tornLine = generateTornLine(\n          this.currentLine.start,\n          this.currentLine.end,\n          lineLength,\n          parseInt(`${lineLength / 5}`, 10),\n          Math.PI,\n        );\n      });\n\n    // Draw and animate torn line on the canvas.\n    this.tick$\n      .pipe(\n        filter((time) => time % this.settings.data.lineLifeTicks !== 0),\n        map((time) => time % this.settings.data.lineLifeTicks),\n        map((timer) => {\n          const endPointWithoutOffset = {\n            x: this.currentLine.end.x - this.currentLine.start.x,\n            y: this.currentLine.end.y - this.currentLine.start.y,\n          };\n          const lineRadianAngle = calcLineAngle(endPointWithoutOffset);\n          const halfPI = Math.PI / 2;\n\n          return {\n            left: calcPointInPolarSystem(lineRadianAngle + halfPI, timer / this.settings.data.distanceCoefficient),\n            right: calcPointInPolarSystem(lineRadianAngle - halfPI, timer / this.settings.data.distanceCoefficient),\n          };\n        }),\n\n        map(({ left, right }) => ({\n          left: this.tornLine.map((point) => applyOffset(point, left)),\n          right: this.tornLine.reverse().map((point) => applyOffset(point, right)),\n        })),\n\n        switchMap((figure) =>\n          forkJoin([\n            this.canvas.drawImage(this.prevCanvasImg, { x: 0, y: 0 }),\n            this.canvas.drawFigure(figure, this.settings.data.lineColor, this.settings.data.backgroundColor),\n          ]),\n        ),\n      )\n      .subscribe();\n  }\n}\n","import AnimationV1 from './animation.v1';\nimport { settings } from './settings';\nimport { Canvas } from './canvas';\n\nconst WIDTH = window.innerWidth + 600;\nconst HEIGHT = window.innerHeight + 600;\n\nconst canvas = new Canvas(document.createElement('canvas'), WIDTH, HEIGHT);\nconst img = document.createElement('img');\n\ndocument.body.append(canvas.canvas);\n\nconst animation = new AnimationV1(canvas, img, WIDTH, HEIGHT, { x: 600, y: 600 }, settings);\n\nconsole.log(settings);\n\n(function render() {\n  animation.dispatch();\n  requestAnimationFrame(render);\n})();\n"],"names":["$5mF43","parcelRequire","$d180e48e458a4be4$var$WIDTH","window","innerWidth","$d180e48e458a4be4$var$HEIGHT","innerHeight","$d180e48e458a4be4$var$canvas","$ltQS0","Canvas","document","createElement","$d180e48e458a4be4$var$img","body","append","canvas","$d180e48e458a4be4$var$animation","tick$","this","_tick$","asObservable","constructor","prevCanvasImg","width","height","offset","settings","$axHCK","BehaviorSubject","sides","$aisEY","generateSides","setup","dispatch","next","value","fill","data","backgroundColor","pipe","$d6DLj","filter","time","lineLifeTicks","$466t7","switchMap","toDataUrl","tap","canvasImg","src","subscribe","currentLine","createLine","lineLength","calcLineLength","start","end","tornLine","generateTornLine","parseInt","Math","PI","$d4PzE","map","timer","endPointWithoutOffset","x","y","lineRadianAngle","calcLineAngle","halfPI","left","calcPointInPolarSystem","distanceCoefficient","right","point","applyOffset","reverse","figure","$c6GPX","forkJoin","drawImage","drawFigure","lineColor","$b8iNZ","console","log","render","requestAnimationFrame"],"version":3,"file":"v1.29ab470d.js.map"}