{"mappings":"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","sources":["src/index.ts","src/animation.v2.ts"],"sourcesContent":["import { CanvasFactory } from './canvas';\nimport AnimationV2 from './animation.v2';\n\nconst WIDTH = window.innerWidth + 600;\nconst HEIGHT = window.innerHeight + 600;\n\nconst animation = new AnimationV2(new CanvasFactory(document), document, WIDTH, HEIGHT, { x: 600, y: 600 });\n\n(function render() {\n  animation.dispatch();\n  requestAnimationFrame(render);\n})();\n","import { BehaviorSubject, filter, forkJoin, map, of, switchMap, tap } from 'rxjs';\n// @ts-ignore\nimport { fromPromise } from 'rxjs/src/internal/observable/innerFrom';\n\nimport {\n  createLine,\n  calcLineLength,\n  generateTornLine,\n  generateSides,\n  generateFigureShape,\n  calcLineAngle,\n  calcPointInPolarSystem\n} from './math';\nimport CanvasFactory from './canvas/canvas.factory';\nimport { Line, Point } from './types';\n\nexport default class AnimationV2 {\n  private realCanvas = this.canvasFactory.createCanvas(this.width, this.height);\n\n  private readonly leftSideImg = this.document.createElement('img');\n\n  private readonly rightSideImg = this.document.createElement('img');\n\n  private readonly _tick$ = new BehaviorSubject(0);\n\n  private readonly sides = generateSides(this.width, this.height);\n\n  private currentLine!: Line;\n\n  public get tick$() {\n    return this._tick$.asObservable();\n  }\n\n  constructor(\n    private readonly canvasFactory: CanvasFactory,\n    private readonly document: Document,\n    private readonly width: number,\n    private readonly height: number,\n    private readonly offset: Point,\n    private readonly lineLifeTicks = 100,\n    private readonly speed = 7,\n    private readonly backgroundColor = 'black',\n    private readonly lineColor = 'white'\n  ) {\n    const root = document.querySelector('.root');\n\n    root?.appendChild(this.realCanvas.canvas);\n\n    this.setup();\n  }\n\n  public dispatch() {\n    this._tick$.next(this._tick$.value + 1);\n  }\n\n  private setup() {\n    this.realCanvas.fill(this.backgroundColor);\n\n    // Generate and save left and right figures every this.lineLifeTicksms.\n    this.tick$\n      .pipe(\n        filter((time) => time % this.lineLifeTicks === 0),\n        map(() => {\n          this.currentLine = createLine(this.sides, this.offset);\n          const lineLength = calcLineLength(this.currentLine.start, this.currentLine.end);\n\n          const line = generateTornLine(\n            this.currentLine.start,\n            this.currentLine.end,\n            lineLength,\n            parseInt(`${lineLength / 7}`, 10),\n            Math.PI\n          );\n\n          return generateFigureShape(line, this.width, this.height, this.sides);\n        }),\n        switchMap((figure) =>\n          forkJoin([this.drawPathOnTempCanvas(figure.left), this.drawPathOnTempCanvas(figure.right)])\n        ),\n        tap(([left, right]) => {\n          this.leftSideImg.src = left;\n          this.rightSideImg.src = right;\n        })\n      )\n      .subscribe();\n\n    // Draw and animate parts on real canvas.\n    this.tick$\n      .pipe(\n        filter((time) => time % this.lineLifeTicks !== 0),\n        map((time) => time % this.lineLifeTicks),\n        map((timer) => {\n          const endPointWithoutOffset = {\n            x: this.currentLine.end.x - this.currentLine.start.x,\n            y: this.currentLine.end.y - this.currentLine.start.y\n          };\n          const lineRadianAngle = calcLineAngle(endPointWithoutOffset);\n\n          return {\n            left: calcPointInPolarSystem(lineRadianAngle - Math.PI / 2, timer / this.speed),\n            right: calcPointInPolarSystem(lineRadianAngle + Math.PI / 2, timer / this.speed)\n          };\n        }),\n        switchMap(({ left, right }) =>\n          forkJoin([\n            this.realCanvas.clear(),\n            fromPromise(Promise.resolve().then(() => this.realCanvas.fill(this.backgroundColor))),\n            this.realCanvas.drawImage(this.leftSideImg, left),\n            this.realCanvas.drawImage(this.rightSideImg, right)\n          ])\n        )\n      )\n      .subscribe();\n  }\n\n  private drawPathOnTempCanvas(path: Point[]) {\n    return of(this.canvasFactory.createCanvas(this.width, this.height)).pipe(\n      switchMap((canvas) =>\n        forkJoin([\n          canvas.drawPath(path, this.lineColor, this.backgroundColor),\n          canvas.drawImage(this.realCanvas.canvas, { x: 0, y: 0 })\n        ]).pipe(switchMap(() => canvas.toDataUrl()))\n      )\n    );\n  }\n}\n"],"names":["$ltQS0","parcelRequire","$5mF43","$b4e14b6b8da86996$var$WIDTH","window","innerWidth","$b4e14b6b8da86996$var$HEIGHT","innerHeight","$b4e14b6b8da86996$var$animation","tick$","this","_tick$","asObservable","constructor","canvasFactory","document","width","height","offset","lineLifeTicks","speed","backgroundColor","lineColor","realCanvas","createCanvas","leftSideImg","createElement","rightSideImg","$axHCK","BehaviorSubject","sides","$aisEY","generateSides","root","querySelector","appendChild","canvas","setup","dispatch","next","value","fill","pipe","$d6DLj","filter","time","$d4PzE","map","currentLine","createLine","lineLength","calcLineLength","start","end","line","generateTornLine","parseInt","Math","PI","generateFigureShape","$466t7","switchMap","figure","$c6GPX","forkJoin","drawPathOnTempCanvas","left","right","tap","src","subscribe","timer","endPointWithoutOffset","x","y","lineRadianAngle","calcLineAngle","calcPointInPolarSystem","clear","$8208i","fromPromise","Promise","resolve","then","drawImage","path","$2b25J","of","drawPath","toDataUrl","CanvasFactory","render","requestAnimationFrame"],"version":3,"file":"index.a28888cf.js.map"}